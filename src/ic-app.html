<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="ic-icons.html">
<link rel="import" href="shared-styles.html">

<dom-module id="ic-app">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment shared-styles">
            :host {
        --app-primary-color: #2b2b2b;
        --app-secondary-color: black;

        display: block;
      }

      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      app-drawer{
          --app-drawer-width:220px;
      }

      paper-button{
          text-transform:none;
      }

      .drawer-list{      
        display: flex;
        flex-direction: column;
        padding-left:12px;
      }

      .drawer-link{
          display:flex;
          padding:1px 0;
          background-color:#515151;
      }

      .link-content{          
          width: 81.8%;
      }

      .drawer-link .dummy{
          width:6px;
          background-color:#666666;
      }
      
      .drawer-link a {
        display: flex;
        padding: 0 16px;
        text-decoration: none;
        line-height: 52px;
        color: #666666;
        background-color:#2b2b2b;
        width:100%;
        align-items: center;
      }

      .drawer-link iron-icon{
          margin-right:10px;
          width: 20px;
          height:20px;
      }

      .drawer-list .drawer-link.iron-selected a {
        color: #c5c5c5;
        font-weight: bold;      
        background-color:#515151;
      }

      .drawer-list .drawer-link.iron-selected .dummy {    
        background-color:#c5c5c5;
      }

      app-drawer{
          --app-drawer-content-container:{
                background-color:#2b2b2b;
                color: #ffffff;
          };         
      }

      #content{
          @apply(--layout-flex);
      }

      #pages-content{
          height:100%;
      }

      .logged-toolbar{
          background-color:#2b2b2b;
          justify-content: flex-end;
      }
      
      .default-toolbar{
          background-color:#ef6751;
      }
      
      #home-toolbar{
      	width: 100%;
      }  
      
      #links > paper-button, #links > paper-button > a{
      	text-transform: none;
      	padding: 5px 7px;
      	color: #ffffff;
      	border-radius: 5px;
      }
      
      #links > paper-button:hover > a, #links > paper-button.iron-selected > a{
		background-color: #ffffff;
		color: #ef6751;		
      }

      #isi-logo{
	    width: 150px;
	    height: 91px;
      }

      #links{          
        display: flex;
        align-items: center;
      }

      #logo-v2{
          width:181px;
          height: 27px;
          background-image: url('../images/dashboard/logo.png')
      }

      #end-toolbar{
          color:#666666;
          align-items: baseline;
      }

      #end-toolbar paper-button:hover{
          color:#ffffff;
      }

      #webapp-toolbar{
          width:95%;
          justify-content:space-between;
      }

      #arian-wire{
        margin-left: 150px;
        align-items: center;
        width: 410px;
        height: 64px;
        justify-content: space-around;
        cursor:default;
      }

      #arian-wire span{
        font-size:15px;
      }

      #arian-wire iron-icon{
          width:20px;
          height: 20px;
      }

      .arian-wire{
          color: #666666;
      }      

      .arian-wire[selected]{
          color: #ffffff;
      }

      #customer-logo{
          background-image: url('../images/dashboard/Logo-Hatier.png');
          background-repeat:no-repeat;
          background-size:contain;
          width: 100%;
          height: 55px;
      }

      #fakeDrawer{
          width:202px;
          height: 615px;
      }

        </style>

        <app-location route="{{route}}"></app-location>
        <app-route route="{{route}}"
                   pattern="/:page"
                   data="{{routeData}}"
                   tail="{{subroute}}"></app-route>

        <app-drawer-layout id="layout" fullbleed narrow>
            <!-- Drawer content -->
            <app-drawer id="drawer">
                <app-toolbar>
                    <div id="customer-logo"></div>
                </app-toolbar>
                <iron-selector selected="[[drawerPage]]" attr-for-selected="name" class="drawer-list" role="navigation">
                    <div name="dashboard" class="drawer-link">
                        <div class="dummy">&nbsp;</div>
                        <div class="layout vertical link-content">                        
                            <a href="/dashboard"><iron-icon icon="ic-icons:dashboard"></iron-icon> DASHBOARD</a>
                        </div>
                    </div>
                    <div name="catalogue" class="drawer-link" on-tap="toggleDrawer">
                        <div class="dummy">&nbsp;</div>
                        <div class="layout vertical link-content">  
                            <a href="/catalogue"><iron-icon icon="ic-icons:catalogue"></iron-icon>COLLECTION</a>
                            <iron-collapse id="fakeDrawerCollapse" opened="[[drawerOpened]]">
                                <div id="fakeDrawer"></div>
                            </iron-collapse>
                        </div>
                    </div>
                    <div name="archives" class="drawer-link">
                        <div class="dummy">&nbsp;</div>
                        <div class="layout vertical link-content">
                            <a><iron-icon icon="ic-icons:archive"></iron-icon>ARCHIVES</a>
                        </div>
                    </div>
                    <div name="trash" class="drawer-link">
                        <div class="dummy">&nbsp;</div>
                        <div class="layout vertical link-content">  
                            <a> <iron-icon icon="ic-icons:trash"></iron-icon>TRASH</a>
                        </div>
                    </div>
                </iron-selector>
            </app-drawer>

            <!-- Main content -->
            <app-header-layout fullbleed>

                <app-header condenses reveals effects="waterfall">
                    <app-toolbar id="toolbar">

                        <!-- Home region -->
                        <div id="home-toolbar" class="layout horizontal justified">
                            <iron-icon id="isi-logo" icon="ic-icons:isi-header-logo"></iron-icon>
                            <iron-selector id="links" selected="2">
                                <paper-button><a href="http://www.isicrunch.com">Company</a></paper-button>
                                <paper-button><a>Product</a></paper-button>
                                <paper-button><a>ISICrunch Access</a></paper-button>
                                <paper-button><a href="http://www.isicrunch.com/en/contact/index.php">Contact</a></paper-button>
                                <paper-button><a>Support</a></paper-button>
                            </iron-selector>
                        </div>

                        <!-- WebApp region -->
                        <div id="webapp-toolbar" class="layout horizontal">
                            <div id="arian-wire" class="layout horizontal">
                                <div id="ariane-home" selected$="{{homeSelected}}" class="arian-wire">
                                    <iron-icon icon="ic-icons:home"></iron-icon>
                                    <span>Home</span>
                                </div>
                                <div id="ariane-edition" selected$="{{editionSelected}}" class="arian-wire">
                                    <iron-icon icon="ic-icons:edit" ></iron-icon>
                                    <span>Edition</span>
                                </div>
                                <div id="ariane-admin" class="arian-wire">
                                    <iron-icon icon="ic-icons:admin"></iron-icon>
                                    <span>Admin</span>
                                </div>
                                <div id="ariane-help" class="arian-wire">
                                    <iron-icon icon="ic-icons:help"></iron-icon>
                                    <span>Help</span>
                                </div>
                            </div>
                            <div id="end-toolbar" class="layout horizontal">
                                <div id="logo-v2"></div>
                                <paper-button on-tap="signOut"><iron-icon icon="ic-icons:quit"></iron-icon>&nbsp;Quit</paper-button>
                            </div>
                        </div>
                    </app-toolbar>
                </app-header>

                <div id="content">
                    <iron-pages id="pages-content" selected="[[page]]"
                                attr-for-selected="name"
                                fallback-selection="view404"
                                role="main">
                        <ic-home name="home" logged="{{logged}}"></ic-home>
                        <ic-dashboard name="dashboard" on-show-book="showBook"></ic-dashboard>
                        <ic-catalogue name="catalogue" book="{{book}}" on-goto-nav="gotoNav"></ic-catalogue>
                        <ic-navigation name="navigation" book="{{book}}"></ic-navigation>
                        <my-view404 name="view404"></my-view404>
                    </iron-pages>
                </div>
            </app-header-layout>
        </app-drawer-layout>
    </template>

    <script>
        Polymer({
            is: 'ic-app',

            properties: {
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                },

                logged: {
                    type: Boolean,
                    value: false,
                    observer: '_loggedChanged'
                },

                book: Object,

                drawerOpened: {
                    type: Boolean,
                    value: false
                }
            },

            observers: [
                '_routePageChanged(routeData.page)'
            ],

            ready: function() {
                this.async(function() {
                    this.logged = window.sessionStorage.getItem('log');
                }.bind(this));

                this.ariane = 'home';
            },

            _routePageChanged: function(page) {
                this.drawerPage = page == 'navigation' ? 'catalogue' : page;

                if (page == 'dashboard') {
                    this.homeSelected = true;
                    this.editionSelected = false;

                    this.drawerOpened = false;
                } else if (page == 'catalogue') {
                    this.homeSelected = false;
                    this.editionSelected = true;

                    if (this.book)
                        this.drawerOpened = true;
                }

                if (!this.logged) {
                    this.page = 'home';
                } else {
                    this.page = page || 'dashboard';
                }
            },

            _pageChanged: function(page) {
                var resolvedPageUrl = this.resolveUrl('ic-' + page + '.html');
                this.importHref(resolvedPageUrl, null, this._showPage404, true);
            },

            _loggedChanged: function(e) {

                if (!this.logged) {
                    this.$.drawer.close();

                    this.$.drawer.classList.add('hidden');
                    this.$.drawer.classList.remove('visible')
                } else {
                    this.$.drawer.open();

                    this.$.drawer.classList.add('visible');
                    this.$.drawer.classList.remove('hidden')
                }

                this.$.layout.resetLayout();

                if (this.logged) {
                    this.set('routeData.page', 'dashboard');
                    window.sessionStorage.setItem('log', true);
                } else {
                    this.set('routeData.page', '');
                }

                this._setToolbar();
            },

            _setToolbar: function() {
                if (this.logged) {
                    this.$.toolbar.classList.remove('default-toolbar');
                    this.$.toolbar.classList.add('logged-toolbar');

                    this.$$('#home-toolbar').classList.add('hidden');
                    this.$$('#home-toolbar').classList.remove('visible');

                    this.$$('#webapp-toolbar').classList.add('visible');
                    this.$$('#webapp-toolbar').classList.remove('hidden');
                } else {
                    this.$.toolbar.classList.remove('logged-toolbar');
                    this.$.toolbar.classList.add('default-toolbar');

                    this.$$('#home-toolbar').classList.add('visible');
                    this.$$('#home-toolbar').classList.remove('hidden');

                    this.$$('#webapp-toolbar').classList.add('hidden');
                    this.$$('#webapp-toolbar').classList.remove('visible');
                }
            },

            signOut: function() {
                this.logged = false;
                window.sessionStorage.removeItem('log');
            },

            _showPage404: function() {
                this.page = 'view404';
            },

            showBook: function(e) {
                this.book = e.detail.book;
                this.set('routeData.page', 'catalogue');

                this.$.fakeDrawer.style.backgroundImage = 'url("../images/drawer/' + this.book.fakeDrawer + '")';
            },

            toggleDrawer: function() {
                if (this.book && this.page != 'navigation') {
                    this.$.fakeDrawerCollapse.toggle();
                }
            },

            gotoNav: function() {
                this.set('routeData.page', 'navigation');
            }
        });
    </script>
</dom-module>