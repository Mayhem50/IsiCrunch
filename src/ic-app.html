<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="ic-icons.html">
<link rel="import" href="shared-styles.html">

<dom-module id="ic-app">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment shared-styles">
      :host {
        --app-primary-color: #4285f4;
        --app-secondary-color: black;

        display: block;
      }

      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      app-drawer{
          --app-drawer-width:220px;
      }

      .drawer-list{      
        display: flex;
        flex-direction: column;
        padding-left:20px;
      }

      .drawer-link{
          display:flex;
          padding:1px 0;
          background-color:#515151;
      }

      .drawer-link > div{
          width:10px;
          background-color:#515151;
      }

      .drawer-link a {
        display: block;
        padding: 0 16px;
        text-decoration: none;
        line-height: 40px;
        color: #ffffff;
        background-color:#434343;
        width:100%;
      }

      .drawer-list .drawer-link.iron-selected > a {
        color: black;
        font-weight: bold;      
        background-color:#d8d8d8;
      }

      app-drawer{
          --app-drawer-content-container:{
                background-color:#3d3d3d;
                color: #ffffff;
          };         
      }

      #content{
          @apply(--layout-flex);
      }

      #pages-content{
          height:100%;
      }

      .logged-toolbar{
          background-color:#3d3d3d;
          justify-content: flex-end;
      }
      
      .default-toolbar{
          background-color:#ef6751;
      }
      
      #home-toolbar{
      	width: 100%;
      }  
      
      #links > paper-button, #links > paper-button > a{
      	text-transform: none;
      	padding: 5px 7px;
      	color: #ffffff;
      	border-radius: 5px;
      }
      
      #links > paper-button:hover > a, #links > paper-button.iron-selected > a{
		background-color: #ffffff;
		color: #ef6751;		
      }

      #isi-logo{
          width:95px;
          height:64px;
      }

      #links{          
        display: flex;
        align-items: center;
      }
            
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

    <app-drawer-layout id="layout" fullbleed narrow>
      <!-- Drawer content -->
      <app-drawer id="drawer" >
        <app-toolbar>
        	<div id="customer-logo"></div>
        </app-toolbar>
        <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">  
            <div name="dashboard" class="drawer-link">
                <div>&nbsp;</div>
                <a href="/dashboard">DASHBOARD</a>
            </div>     
            <div name="collections" class="drawer-link">
                <div>&nbsp;</div>
                <a href="/dashboard">COLLECTIONS</a>
            </div> 
            <div name="archives" class="drawer-link">
                <div>&nbsp;</div>
                <a href="/dashboard">ARCHIVES</a>
            </div> 
            <div name="trash" class="drawer-link">
                <div>&nbsp;</div>
                <a href="/dashboard">TRASH</a>
            </div> 
        </iron-selector>
      </app-drawer>

      <!-- Main content -->
      <app-header-layout fullbleed>

        <app-header condenses reveals effects="waterfall">
            <app-toolbar id="toolbar">
            
            	<!-- Home region -->
            	<div id="home-toolbar" class="layout horizontal justified">
                    <embed id="isi-logo" type="image/svg+xml" src="../images/home/logo_header.svg" />
	                <iron-selector id="links" selected="2">
	                	<paper-button><a href="http://www.isicrunch.com">Company</a></paper-button>
	                	<paper-button><a>Product</a></paper-button>
	                	<paper-button><a>ISICrunch Access</a></paper-button>
	                	<paper-button><a href="http://www.isicrunch.com/en/contact/index.php">Contact</a></paper-button>
	                	<paper-button><a>Support</a></paper-button>
                	</iron-selector>
                </div>
                
                <!-- WebApp region -->
            	<div id="webapp-toolbar">
	                <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
	                <div>ISI Crunchy</div>
                </div>
            </app-toolbar>
        </app-header>

          <div id="content">
              <iron-pages id="pages-content" selected="[[page]]"
                          attr-for-selected="name"
                          fallback-selection="view404"
                          role="main">
                  <ic-home name="home" logged="{{logged}}"></ic-home>
                  <ic-dashboard name="dashboard"></ic-dashboard>
                  <my-view3 name="view3"></my-view3>
                  <my-view404 name="view404"></my-view404>
              </iron-pages>
          </div>
      </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
      Polymer({
          is: 'ic-app',

          properties: {
              page: {
                  type: String,
                  reflectToAttribute: true,
                  observer: '_pageChanged'
              },

              logged: {
                  type: Boolean,
                  value: false,
                  observer: '_loggedChanged'
              }
          },

          observers: [
            '_routePageChanged(routeData.page)'
          ],
          
          ready: function () {
              this.async(function () {
                  this.logged = window.sessionStorage.getItem('log');
              }.bind(this));
          },

          _routePageChanged: function (page) {
        	  
              this.page = page || 'home';              
          },

          _pageChanged: function (page) {
              var resolvedPageUrl = this.resolveUrl('ic-' + page + '.html');
              this.importHref(resolvedPageUrl, null, this._showPage404, true);
          },

          _loggedChanged: function (e) {
              this.$.drawer.hidden = !this.logged;
              this.$.layout.resetLayout();

              if (this.logged) {
                  this.set('routeData.page', 'dashboard');
                  window.sessionStorage.setItem('log', true);
              }
              else {
                  this.set('routeData.page', '');
              }

              this._setToolbar();
          },

          _setToolbar: function () {
              if (this.logged) {
                  this.$.toolbar.classList.remove('default-toolbar');
                  this.$.toolbar.classList.add('logged-toolbar');

                  this.$$('#home-toolbar').classList.add('hidden');
                  this.$$('#home-toolbar').classList.remove('visible');
                  
                  this.$$('#webapp-toolbar').classList.add('visible');
                  this.$$('#webapp-toolbar').classList.remove('hidden');
              }
              else {
                  this.$.toolbar.classList.remove('logged-toolbar');
                  this.$.toolbar.classList.add('default-toolbar');
                  
                  this.$$('#home-toolbar').classList.add('visible');
                  this.$$('#home-toolbar').classList.remove('hidden');

                  this.$$('#webapp-toolbar').classList.add('hidden');
                  this.$$('#webapp-toolbar').classList.remove('visible');
              }
          },

          _showPage404: function () {
              this.page = 'view404';
          }
      });
  </script>
</dom-module>
